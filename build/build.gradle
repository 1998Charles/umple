apply plugin: 'groovy'

repositories {
	mavenCentral()
}

dependencies {
	compile gradleApi()
	compile localGroovy()
}

buildscript {
    repositories {
        maven {
            url uri('../../libs')
        }
		jcenter()
    }
    dependencies {
		classpath files('../../libs/umple.jar')
		classpath group: 'cruise.umple', name: 'UmpleGradlePlugin',  version: '0.0.3'
		classpath 'de.undercouch:gradle-download-task:3.1.2'
    }
}

apply plugin: 'umple.gradle.plugin'
apply plugin: 'de.undercouch.download'

import de.undercouch.gradle.tasks.download.Download
import org.gradle.api.GradleException


// downloads the umple jar only if the online version is newer
download {
	onlyIfNewer = true
	overwrite = true
    src 'http://cruise.eecs.uottawa.ca/umpleonline/scripts/umple.jar'
    dest '../../libs/'
}

// set project properties for umple plugin
project.ext.set("umpleFileName", "test.ump")
assert project.umpleFileName == "test.ump"

project.ext.set("languageToGenerate", "Java")
assert project.languageToGenerate == "Java"

// Get all dependencies installed
task bootstrap << {
    
	
	
}

// Perform a first build to get umple related stuff installed 
task firstBuild << {
    
	
	
}

// full build
task fullBuild << {
    
	
	
}

// quick build
task quickBuild << {
	
	
	
}

// build only umple
task buildUmple << {
	
	
	
}

// build only umple eclipse plugin
task buildUmpleEclipsePlugin << {
	
	
	
}

// build only umplificator eclipse plugin
task buildUmplificatorEclipsePlugin << {
	
	
	
}

// qaBuildingPage #TODO_AH figure out what this is
task qaBuildingPage << {
    
	
	
}

// qaLandingPage #TODO_AH figure out what this is
task qaLandingPage << {
    
	
	
}

// Turn *.ump code from Umple into *.java
task umpleSelf << {
    
	
	
}

// Compile *.java into byte code
task compileUmple << {
    
	
	
}

// Compile the all testbed programs against the latest umple.jar
task testUmple << {
    // Do nothing, this will call testJava, testPHP, and testRuby
	// as specified by the multiple "dependsOn" at the bottom
}

// Compile the Java testbed program against the latest umple.jar
task compileUmpleToJava << {
	def compileUmpleToJavaSucceeded = true

	// #TODO_AH implement java compile
	
	if(compileUmpleToJavaSucceeded)
	{

	}
	else
	{
		throw new GradleException("compileUmpleToJava failed")
	}
}

// Compile the PHP testbed program against the latest umple.jar
task compileUmpleToPHP << {
	def compileUmpleToPHPSucceeded = true

	// #TODO_AH implement php compile
	
	if(compileUmpleToPHPSucceeded)
	{

	}
	else
	{
		throw new GradleException("compileUmpleToPHP failed")
	}
}

// Compile the Ruby testbed program against the latest umple.jar
task compileUmpleToRuby << {
	def compileUmpleToRubySucceeded = true

	// #TODO_AH implement ruby compile

	if(compileUmpleToRubySucceeded)
	{

	}
	else
	{
		throw new GradleException("compileUmpleToRuby failed")
	}
}

// Test the Java testbed program against the latest umple.jar
task testJava(dependsOn: 'compileUmpleToJava') << {
	def testJavaSucceeded = true

	// #TODO_AH implement Java test
	
	if(testJavaSucceeded)
	{
		println " testJava succeeded"
	}
	else
	{
		throw new GradleException("testJava failed")
	}
}

// Test the PHP testbed program against the latest umple.jar
task testPHP(dependsOn: 'compileUmpleToPHP') << {
	def testPHPSucceeded = true

	// #TODO_AH implement PHP test
	
	if(testPHPSucceeded)
	{
		
	}
	else
	{
		throw new GradleException("testPHP failed")
	}
}

// Test the Ruby testbed program against the latest umple.jar
task testRuby(dependsOn: 'compileUmpleToRuby') << {
	def testRubySucceeded = true

	// #TODO_AH implement ruby test
	
	if(testRubySucceeded)
	{
		
	}
	else
	{
		throw new GradleException("testRuby failed")
	}
}

// order matters, dependencies need to be specified after task declaration/definition
// #TODO_AH find out if we it's possible to forward declare?
testUmple.dependsOn testJava
testUmple.dependsOn testPHP
testUmple.dependsOn testRuby